<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HTML Oneâ€‘File Playground â€¢ Editor + Preview + Console</title>
  <meta name="description" content="A single-file HTML/CSS/JS playground with Monaco editor, preview, console, draggable split panes, maximize panes, and share URL. Host on GitHub Pages." />
  <link rel="icon" type="image/svg+xml" href="https://deyeskay.github.io/hub/sk-download.svg">
  <style>
    :root{
      --bg: #0b0e12; --pane:#121720; --pane-2:#0f141c; --ac:#00d1b2; --fg:#dbe2ee; --muted:#93a1b3; --border:#1d2633;
      --btn:#151b24; --btn2:#18202b; --yellow:#ffd866; --red:#ff5370; --green:#a6e22e;
      --col-left: 1.3fr; --col-right: 1fr; --row-top: 1fr; --row-bottom: 220px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.4 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial}
    .toolbar{display:flex;gap:8px;align-items:center;padding:10px 12px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#0d1219,#0b0e12)}
    .logo{display:flex;align-items:center;font-weight:700;letter-spacing:.2px}
    .spacer{flex:1}
    .btn{background:var(--btn);border:1px solid var(--border);color:var(--fg);padding:8px 12px;border-radius:10px;cursor:pointer;display:inline-flex;gap:8px;align-items:center}
    .btn:hover{background:var(--btn2)}
    .btn[data-primary]{border-color:#0e2;box-shadow:0 0 0 1px #0e2 inset}
    .btn small{opacity:.8}
    .kbd{padding:2px 6px;border:1px solid var(--border);border-bottom-width:2px;border-radius:6px;background:#0c1117;color:var(--muted);font-size:12px}

    .wrap{height:calc(100% - 54px);display:grid;grid-template-columns: var(--col-left) 8px var(--col-right);grid-template-rows: var(--row-top) 8px var(--row-bottom);gap:10px;padding:10px}
    .pane{background:var(--pane);border:1px solid var(--border);border-radius:14px;overflow:hidden;display:flex;flex-direction:column;min-height:0;position:relative}
    .pane header{display:flex;align-items:center;gap:8px;padding:8px 10px;border-bottom:1px solid var(--border);background:var(--pane-2)}
    .pane header .title{font-weight:600}
    .pane header .right{margin-left:auto;display:flex;gap:6px}
    .mini-btn{background:transparent;border:1px solid var(--border);border-radius:8px;color:var(--muted);padding:6px;cursor:pointer;display:inline-flex}
    .mini-btn:hover{color:var(--fg);background:#121823}
    .tabs{display:flex;gap:6px;padding:8px;border-bottom:1px solid var(--border);background:var(--pane)}
    .tab{padding:6px 10px;border:1px solid var(--border);border-radius:10px;cursor:pointer;color:var(--muted)}
    .tab.active{color:var(--fg);background:#0c121a}

    #editorHost{flex:1;position:relative;min-height:0}
    #previewFrame{border:0;flex:1;background:#fff}
    #console{flex:1;background:#0a0e13;font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;padding:8px;overflow:auto}
    .log{white-space:pre-wrap}
    .log .t{color:#667}
    .log .info{color:#9ee}
    .log .warn{color:var(--yellow)}
    .log .err{color:var(--red)}

    /* Grid placement */
    .pane.editor{grid-column:1;grid-row:1 / span 3}
    .pane.preview{grid-column:3;grid-row:1}
    .pane.console{grid-column:3;grid-row:3}

    /* Gutters (drag handles) */
    .gutter{background:var(--pane-2); border:1px solid var(--border); border-radius:10px; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);} 
    .gutter.col{grid-column:2; grid-row:1 / span 3; cursor:col-resize; min-width:8px; display:grid; place-items:center}
    .gutter.row{grid-column:3; grid-row:2; cursor:row-resize; min-height:8px}
    .gutter .dot{width:3px; height:28px; border-radius:2px; background:#2a3342}

    /* Maximize overlays */
    body.max-open{overflow:hidden}
    .pane.max{position:fixed;inset:0;z-index:100;box-shadow:none;width:100vw;height:100vh;background:var(--pane);}
    .pane.max .glass{display:none}
    .pane.max header{position:sticky;top:0;z-index:101}
    .pane.max .tabs{position:sticky;top:42px;z-index:101}

    /* Toast */
    .toast{position:fixed;right:12px;bottom:12px;background:#101622;border:1px solid var(--border);color:var(--fg);padding:8px 12px;border-radius:10px;opacity:0;transform:translateY(10px);transition:.3s;z-index:60}
    .toast.show{opacity:1;transform:translateY(0)}

    @media (max-width: 980px){
      .wrap{grid-template-columns: 1fr; grid-template-rows: 1fr 380px 220px}
      .pane.editor{grid-column:1;grid-row:1}
      .pane.preview{grid-column:1;grid-row:2}
      .pane.console{grid-column:1;grid-row:3}
      .gutter{display:none}
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <div class="logo" title="HTML Oneâ€‘File Playground">
      <img src="https://deyeskay.github.io/hub/sk-download.svg" alt="SK Games logo" style="width: 30px; margin-right:8px;">
      <span>Playground</span>
    </div>
    <button id="runBtn" class="btn" data-primary>
      â–¶ Run <span class="kbd">Ctrl/Cmd+Enter</span>
    </button>
    <button id="shareBtn" class="btn">Share URL <small>(Ctrl/Cmd+S)</small></button>
    <button id="downloadBtn" class="btn">Download files</button>
    <div class="spacer"></div>
    <button id="themeBtn" class="btn" title="Toggle theme">ðŸŒ™ Theme</button>
    <button id="fullscreenBtn" class="btn" title="Fullscreen">â›¶ Fullscreen</button>
    <a class="btn" href="https://microsoft.github.io/monaco-editor/" target="_blank" rel="noreferrer">Monaco Docs â†—</a>
  </div>

  <div class="wrap">
    <!-- EDITOR -->
    <section class="pane editor" id="editorPane" aria-label="Editor">
      <div class="glass" aria-hidden="true"></div>
      <header>
        <div class="title">Editor</div>
        <div class="right">
          <button class="mini-btn" id="maxEditor" title="Maximize editor">â›¶</button>
        </div>
      </header>
      <nav class="tabs" id="tabs"></nav>
      <div id="editorHost" aria-live="polite"></div>
    </section>

    <!-- Column Gutter -->
    <div id="colGutter" class="gutter col" title="Drag to resize (doubleâ€‘click to reset)"><span class="dot"></span></div>

    <!-- PREVIEW -->
    <section class="pane preview" id="previewPane" aria-label="Preview">
      <header>
        <div class="title">Preview</div>
        <div class="right">
          <button class="mini-btn" id="openNewTab" title="Open preview in new tab">â†—</button>
          <button class="mini-btn" id="maxPreview" title="Maximize preview">â›¶</button>
        </div>
      </header>
      <iframe id="previewFrame" sandbox="allow-scripts allow-same-origin allow-popups" title="Preview output"></iframe>
    </section>

    <!-- Row Gutter -->
    <div id="rowGutter" class="gutter row" title="Drag to resize (doubleâ€‘click to reset)"></div>

    <!-- CONSOLE -->
    <section class="pane console" id="consolePane" aria-label="Console">
      <header>
        <div class="title">Console</div>
        <div class="right">
          <button class="mini-btn" id="clearConsole" title="Clear Console">ðŸ—‘</button>
          <button class="mini-btn" id="maxConsole" title="Maximize console">â›¶</button>
        </div>
      </header>
      <div id="console" class="log" role="log" aria-live="polite"></div>
    </section>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Monaco + LZString from CDN -->
  <script>
    window.require = { paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' } };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>

  <script>
  (function(){
    // ---------- Defaults ----------
    const DEFAULTS={
      html:`<!doctype html>\n<html>\n<head>\n  <meta charset='utf-8'>\n  <meta name='viewport' content='width=device-width, initial-scale=1'>\n  <title>Playground App</title>\n</head>\n<body>\n  <h1>Hello, Playground! ðŸ‘‹</h1>\n  <button id='btn'>Click me</button>\n  <p>Edit HTML/CSS/JS and press <b>Run</b> or <b>Ctrl/Cmd+Enter</b>.</p>\n</body>\n</html>`,
      css:`body{font-family:system-ui} h1{color:#0d9488}`,
      js:`console.log('Welcome!');\nconst btn=document.getElementById('btn');\nif(btn){btn.addEventListener('click',()=>console.log('Button clicked at',new Date().toLocaleTimeString()))}`
    };
    const STORAGE_KEY='onefile-playground-v1';
    // Default split ratios
    const DEFAULT_COL_RATIO = 0.6;  // 60/40 editorâ€“preview
    const DEFAULT_ROW_RATIO = 0.6;  // 60/40 previewâ€“console

    // ---------- Elements ----------
    const el={
      runBtn: document.getElementById('runBtn'),
      shareBtn: document.getElementById('shareBtn'),
      downloadBtn: document.getElementById('downloadBtn'),
      themeBtn: document.getElementById('themeBtn'),
      fullscreenBtn: document.getElementById('fullscreenBtn'),
      tabs: document.getElementById('tabs'),
      editorHost: document.getElementById('editorHost'),
      previewFrame: document.getElementById('previewFrame'),
      console: document.getElementById('console'),
      toast: document.getElementById('toast'),
      maxEditor: document.getElementById('maxEditor'),
      maxPreview: document.getElementById('maxPreview'),
      maxConsole: document.getElementById('maxConsole'),
      openNewTab: document.getElementById('openNewTab'),
      clearConsole: document.getElementById('clearConsole'),
      editorPane: document.getElementById('editorPane'),
      previewPane: document.getElementById('previewPane'),
      consolePane: document.getElementById('consolePane'),
      colGutter: document.getElementById('colGutter'),
      rowGutter: document.getElementById('rowGutter'),
      wrap: document.querySelector('.wrap')
    };

    const tabs=[
      {id:'html', name:'HTML', lang:'html'},
      {id:'css', name:'CSS', lang:'css'},
      {id:'js', name:'JS', lang:'javascript'}
    ];

    let editors={};
    let editorContainers={};
    let activeTab='html';
    let monaco;

    // ---------- Helpers ----------
    function toast(msg){
      el.toast.textContent=msg; el.toast.classList.add('show');
      clearTimeout(toast._t); toast._t=setTimeout(()=>el.toast.classList.remove('show'), 1600);
    }

    function loadState(){
      try{
        const params=new URLSearchParams(location.hash.slice(1));
        if(params.get('z')){
          const json=LZString.decompressFromEncodedURIComponent(params.get('z'));
          if(json){ return JSON.parse(json); }
        }
      }catch(e){ console.warn('Hash decode error', e); }
      try{
        const s=localStorage.getItem(STORAGE_KEY); if(s) return JSON.parse(s);
      }catch(e){}
      return {html:DEFAULTS.html, css:DEFAULTS.css, js:DEFAULTS.js};
    }

    function getState(){
      return {
        html: editors.html?.getValue() ?? DEFAULTS.html,
        css: editors.css?.getValue() ?? DEFAULTS.css,
        js: editors.js?.getValue() ?? DEFAULTS.js
      }
    }

    function setTheme(mode){
      if(mode==='light'){
        document.documentElement.dataset.theme='light';
        document.documentElement.style.setProperty('--bg','#f5f7fb');
        document.documentElement.style.setProperty('--pane','#ffffff');
        document.documentElement.style.setProperty('--pane-2','#f2f5fb');
        document.documentElement.style.setProperty('--fg','#0b0e12');
        document.documentElement.style.setProperty('--muted','#425067');
        document.documentElement.style.setProperty('--border','#e8eef7');
        document.documentElement.style.setProperty('--btn','#f7f9fe');
        document.documentElement.style.setProperty('--btn2','#eef3fb');
      } else {
        document.documentElement.dataset.theme='dark';
        document.documentElement.style.cssText='';
      }
      if(monaco){ monaco.editor.setTheme(mode==='light'? 'vs':'vs-dark'); }
      localStorage.setItem(STORAGE_KEY+':theme', mode);
    }

    function toggleTheme(){
      const next = (document.documentElement.dataset.theme==='light')? 'dark':'light';
      setTheme(next);
    }

    function restoreTheme(){
      const t=localStorage.getItem(STORAGE_KEY+':theme') || 'dark';
      setTheme(t);
    }

    function buildHTMLDoc({html,css,js}){
      const consoleBridge = `\n<script>\n(function(){\n  const q = (type, args)=> parent.postMessage({type, args}, '*');\n  ['log','info','warn','error'].forEach(k=>{\n    const orig = console[k].bind(console);\n    console[k]=function(){ orig.apply(console, arguments); q('console:'+k, Array.from(arguments)); }\n  });\n  window.addEventListener('error', e=>{ q('console:error', [e.message+' @ '+(e.filename||'')+':'+(e.lineno||'')]); });\n})();\n<\/script>`;
      const userJS = `<script>\ntry{\n${js}\n}catch(e){console.error(e)}\n<\/script>`;

      if(/<\s*html[\s>]/i.test(html)){
        let out = html;
        if(/<\s*head[\s>]/i.test(out)){
          out = out.replace(/<\s*head[\s>]/i, m=> m+`\n<style>\n${css}\n<\/style>`);
        } else {
          out = out.replace(/<\s*body[\s>]/i, m=> `\n<head>\n<style>\n${css}\n<\/style>\n<\/head>\n`+m);
        }
        if(/<\s*body[\s>]/i.test(out)){
          out = out.replace(/<\/\s*body\s*>/i, `${consoleBridge}${userJS}</body>`);
        } else {
          out += `\n<body>${consoleBridge}${userJS}</body>`;
        }
        return out;
      }

      return `<!doctype html>\n<html>\n<head>\n<meta charset='utf-8'/>\n<meta name='viewport' content='width=device-width, initial-scale=1'/>\n<style>\n${css}\n</style>\n</head>\n<body>\n${html}\n${consoleBridge}\n${userJS}\n</body>\n</html>`;
    }

    function run(){
      const doc = buildHTMLDoc(getState());
      const blob = new Blob([doc], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      el.previewFrame.src = url;
      setTimeout(()=>URL.revokeObjectURL(url), 3000);
      el.console.textContent='';
    }

    function logToConsole(kind, args){
      const row = document.createElement('div');
      row.className='row';
      const t = document.createElement('span'); t.className='t'; t.textContent = new Date().toLocaleTimeString();
      const m = document.createElement('span'); m.className = kind; m.style.marginLeft='8px'; m.textContent = args.map(a=>{
        try{ return typeof a==='object'? JSON.stringify(a): String(a); }catch{return String(a)}
      }).join(' ');
      row.append(t,m); el.console.appendChild(row); el.console.scrollTop = el.console.scrollHeight;
    }

    window.addEventListener('message', (e)=>{
      const {type, args} = e.data || {}; if(!type) return;
      if(type.startsWith('console:')){
        const k=type.split(':')[1];
        const map={log:'info',info:'info',warn:'warn',error:'err'}; logToConsole(map[k]||'info', args||[]);
      }
    });

    function switchTab(id){
      activeTab=id;
      [...el.tabs.children].forEach(x=>x.classList.toggle('active', x.dataset.id===id));
      for(const k in editorContainers){ editorContainers[k].style.display = (k===id? 'block':'none'); }
      if(editors[id]){ editors[id].layout(); editors[id].focus(); }
    }

    function createTabs(){
      tabs.forEach(t=>{
        const b=document.createElement('button');
        b.className='tab';
        b.dataset.id=t.id;
        b.textContent=t.name;
        b.addEventListener('click',()=>switchTab(t.id));
        el.tabs.appendChild(b);
      });
    }

    function initEditors(init){
      require(['vs/editor/editor.main'], function(m){
        monaco=m;
        const opts=(lang, val)=>({
          value: val,
          language: lang,
          automaticLayout:true,
          theme: document.documentElement.dataset.theme==='light'? 'vs':'vs-dark',
          fontLigatures: true,
          fontSize: 14,
          minimap:{enabled:false},
          wordWrap:'on',
          scrollBeyondLastLine:false
        });
        tabs.forEach(t=>{
          const div=document.createElement('div');
          div.style.cssText='position:absolute; inset:0;';
          el.editorHost.appendChild(div);
          const ed = monaco.editor.create(div, opts(t.lang, init[t.id]||''));
          editors[t.id]=ed;
          editorContainers[t.id]=div;
          if(t.id!=='html') div.style.display='none';
        });
        [...el.tabs.children].forEach(x=>x.classList.toggle('active', x.dataset.id==='html'));
        switchTab('html');
      });
    }

    function maximizePane(pane){
      const willMax = !pane.classList.contains('max');
      document.body.classList.toggle('max-open', willMax);
      pane.classList.toggle('max', willMax);
      if(pane===el.editorPane && editors && Object.keys(editors).length){
        setTimeout(()=>{ Object.values(editors).forEach(ed=> ed.layout()); }, 50);
      }
    }

    function openInNewTab(){
      const html = buildHTMLDoc(getState());
      const blob = new Blob([html], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      window.open(url, '_blank');
      setTimeout(()=>URL.revokeObjectURL(url), 3000);
    }

    function downloadFiles(){
      const {html,css,js}=getState();
      const save=(name,content)=>{
        const a=document.createElement('a');
        a.href=URL.createObjectURL(new Blob([content],{type:'text/plain'}));
        a.download=name; document.body.appendChild(a); a.click(); a.remove();
        setTimeout(()=>URL.revokeObjectURL(a.href), 2000);
      };
      save('index.html', buildHTMLDoc({html,css,js}));
      save('style.css', css); save('app.js', js);
    }

    function goFullscreen(){
      if(document.fullscreenElement){ document.exitFullscreen(); }
      else{ document.documentElement.requestFullscreen?.(); }
    }

    // ---------- Resizable gutters ----------
    const COL_KEY = STORAGE_KEY+':colSplit';
    const ROW_KEY = STORAGE_KEY+':rowSplit';

    function applySplits(colPx, rowPx){
      if(colPx){ el.wrap.style.setProperty('--col-left', colPx.left+'px'); el.wrap.style.setProperty('--col-right', colPx.right+'px'); }
      if(rowPx){ el.wrap.style.setProperty('--row-top', rowPx.top+'px'); el.wrap.style.setProperty('--row-bottom', rowPx.bottom+'px'); }
      if(editors.html){ Object.values(editors).forEach(ed=>ed.layout()); }
    }

    function computeColSplit(rect, ratio){
      const left = Math.max(300, Math.round(rect.width * ratio) - 4);
      const right = Math.max(300, rect.width - left - 8);
      const total = left + right + 8;
      if(total>rect.width){ const excess = total-rect.width; const fix = Math.ceil(excess/2); return {left:left-fix, right:right-fix}; }
      return {left, right};
    }
    function computeRowSplit(rect, ratio){
      const top = Math.max(160, Math.round(rect.height * ratio) - 4);
      const bottom = Math.max(120, rect.height - top - 8);
      const total = top + bottom + 8;
      if(total>rect.height){ const excess = total-rect.height; const fix = Math.ceil(excess/2); return {top:top-fix, bottom:bottom-fix}; }
      return {top, bottom};
    }

    function initDefaultSplits(){
      const hasCol = !!localStorage.getItem(COL_KEY);
      const hasRow = !!localStorage.getItem(ROW_KEY);
      const rect = el.wrap.getBoundingClientRect();
      if(!hasCol){ applySplits(computeColSplit(rect, DEFAULT_COL_RATIO), null); }
      if(!hasRow){ applySplits(null, computeRowSplit(rect, DEFAULT_ROW_RATIO)); }
    }

    function startColDrag(e){
      e.preventDefault();
      const prevPE = el.previewFrame.style.pointerEvents; el.previewFrame.style.pointerEvents = 'none';
      const prevCursor = document.body.style.cursor; document.body.style.cursor = 'col-resize';
      const wrapRect = el.wrap.getBoundingClientRect();
      const minLeft = 300, minRight = 300;
      function onMove(ev){
        const x = (ev.touches? ev.touches[0].clientX: ev.clientX) - wrapRect.left;
        const left = Math.max(minLeft, Math.min(x-4, wrapRect.width - minRight));
        const right = wrapRect.width - left - 8;
        applySplits({left,right});
      }
      function onUp(){
        const styles = getComputedStyle(el.wrap);
        const left = parseFloat(styles.getPropertyValue('--col-left')) || wrapRect.width*DEFAULT_COL_RATIO;
        const right = parseFloat(styles.getPropertyValue('--col-right')) || (wrapRect.width-left-8);
        localStorage.setItem(COL_KEY, JSON.stringify({left,right}));
        el.previewFrame.style.pointerEvents = prevPE || '';
        document.body.style.cursor = prevCursor || '';
        window.removeEventListener('mousemove', onMove);
        window.removeEventListener('mouseup', onUp);
        window.removeEventListener('touchmove', onMove);
        window.removeEventListener('touchend', onUp);
      }
      window.addEventListener('mousemove', onMove);
      window.addEventListener('mouseup', onUp);
      window.addEventListener('touchmove', onMove, {passive:false});
      window.addEventListener('touchend', onUp);
    }

    function startRowDrag(e){
      e.preventDefault();
      const prevPE = el.previewFrame.style.pointerEvents; el.previewFrame.style.pointerEvents = 'none';
      const prevCursor = document.body.style.cursor; document.body.style.cursor = 'row-resize';
      const wrapRect = el.wrap.getBoundingClientRect();
      const minTop = 160, minBottom = 120;
      function onMove(ev){
        const y = (ev.touches? ev.touches[0].clientY: ev.clientY) - wrapRect.top;
        const top = Math.max(minTop, Math.min(y-4, wrapRect.height - minBottom));
        const bottom = wrapRect.height - top - 8;
        applySplits(null,{top,bottom});
      }
      function onUp(){
        const styles = getComputedStyle(el.wrap);
        const top = parseFloat(styles.getPropertyValue('--row-top')) || (wrapRect.height*DEFAULT_ROW_RATIO);
        const bottom = parseFloat(styles.getPropertyValue('--row-bottom')) || (wrapRect.height-top-8);
        localStorage.setItem(ROW_KEY, JSON.stringify({top,bottom}));
        el.previewFrame.style.pointerEvents = prevPE || '';
        document.body.style.cursor = prevCursor || '';
        window.removeEventListener('mousemove', onMove);
        window.removeEventListener('mouseup', onUp);
        window.removeEventListener('touchmove', onMove);
        window.removeEventListener('touchend', onUp);
      }
      window.addEventListener('mousemove', onMove);
      window.addEventListener('mouseup', onUp);
      window.addEventListener('touchmove', onMove, {passive:false});
      window.addEventListener('touchend', onUp);
    }

    el.colGutter.addEventListener('mousedown', startColDrag);
    el.colGutter.addEventListener('touchstart', startColDrag, {passive:false});
    el.rowGutter.addEventListener('mousedown', startRowDrag);
    el.rowGutter.addEventListener('touchstart', startRowDrag, {passive:false});

    // reset
    el.colGutter.addEventListener('dblclick', ()=>{ localStorage.removeItem(COL_KEY); el.wrap.style.removeProperty('--col-left'); el.wrap.style.removeProperty('--col-right'); initDefaultSplits(); });
    el.rowGutter.addEventListener('dblclick', ()=>{ localStorage.removeItem(ROW_KEY); el.wrap.style.removeProperty('--row-top'); el.wrap.style.removeProperty('--row-bottom'); initDefaultSplits(); });

    // restore saved splits
    try{
      const c = JSON.parse(localStorage.getItem(COL_KEY)||'null');
      const r = JSON.parse(localStorage.getItem(ROW_KEY)||'null');
      if(c||r) applySplits(c,r);
    }catch{}

    // Keyboard shortcuts
    document.addEventListener('keydown', (e)=>{
      const mac = navigator.platform.toUpperCase().includes('MAC');
      const ctrl = mac? e.metaKey : e.ctrlKey;
      if(ctrl && e.key.toLowerCase()==='s'){ e.preventDefault(); const z=LZString.compressToEncodedURIComponent(JSON.stringify(getState())); location.hash='z='+z; localStorage.setItem(STORAGE_KEY, JSON.stringify(getState())); toast('Saved to URL'); }
      if(ctrl && e.key==='Enter'){ e.preventDefault(); run(); }
      if(ctrl && e.key==='1'){ e.preventDefault(); switchTab('html'); }
      if(ctrl && e.key==='2'){ e.preventDefault(); switchTab('css'); }
      if(ctrl && e.key==='3'){ e.preventDefault(); switchTab('js'); }
    });

    // ---------- Init ----------
    restoreTheme();
    const initState = loadState();
    createTabs();
    initEditors(initState);
    window.addEventListener('load', initDefaultSplits);
    requestAnimationFrame(initDefaultSplits);
    run();

    // ---------- Minimal Selfâ€‘Tests (Console) ----------
    function test(name, fn){
      try{ const ok = fn(); logToConsole(ok? 'info':'warn', [`TEST ${ok? 'PASS':'FAIL'}: ${name}`]); }
      catch(err){ logToConsole('err', [`TEST ERROR: ${name} â†’`, err.message||err]); }
    }
    test('Panes exist', ()=> !!(el.editorPane && el.previewPane && el.consolePane));
    test('Gutters exist', ()=> !!(el.colGutter && el.rowGutter));
    test('Monaco loader present', ()=> typeof require==='object');
    test('Default split applies (no saved)', ()=>{
      const colSaved = localStorage.getItem(COL_KEY); const rowSaved = localStorage.getItem(ROW_KEY);
      if(colSaved || rowSaved) return true;
      const rect = el.wrap.getBoundingClientRect();
      const expLeft = Math.round(rect.width * DEFAULT_COL_RATIO) - 4;
      const left = parseFloat(getComputedStyle(el.wrap).getPropertyValue('--col-left'));
      return Math.abs(left - expLeft) < 60;
    });
    test('switchTab shows CSS', ()=>{ switchTab('css'); const vis = editorContainers.css && getComputedStyle(editorContainers.css).display!=='none'; switchTab('html'); return vis && !!editors.css; });
    test('switchTab shows JS', ()=>{ switchTab('js'); const vis = editorContainers.js && getComputedStyle(editorContainers.js).display!=='none'; switchTab('html'); return vis && !!editors.js; });
    test('Maximize toggles class', ()=>{ const before=el.editorPane.classList.contains('max'); maximizePane(el.editorPane); const mid=!before && el.editorPane.classList.contains('max'); maximizePane(el.editorPane); const back=!el.editorPane.classList.contains('max'); return mid && back; });
    test('buildHTMLDoc returns string', ()=> typeof buildHTMLDoc({html:'<h1>A</h1>', css:'h1{color:red}', js:'console.log(1)'})==='string');
    test('drag handlers exist', ()=> typeof startColDrag==='function' && typeof startRowDrag==='function');
  })();
  </script>
</body>
</html>
